services:
  app:
    image: docker.io/YOUR_DOCKERHUB_USER/nas-landing:prod-latest
    container_name: nas-landing-prod
    env_file:
      - .env.production
    environment:
      NODE_ENV: production
      PORT: 8081
      TOOL_SERVICE_URL: http://agent-service:8090
    ports:
      - "8081:8081"
    volumes:
      - ./data:/app/data
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      agent-service:
        condition: service_started
    restart: unless-stopped

  agent-service:
    build:
      context: ./agent-service
    env_file:
      - .env.production
    environment:
      MCP_GATEWAY_URL: ${MCP_GATEWAY_URL:-http://mcp-gateway:8080}
      MCP_TRANSPORT: ${MCP_TRANSPORT:-streamable-http}
    ports:
      - "8090:8090"
    depends_on:
      mcp-gateway:
        condition: service_started
    restart: unless-stopped

  mcp-gateway:
    image: docker/mcp-gateway:latest
    command:
      - --transport=streaming
      - --servers=github
      - --port=8080
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "8080:8080"
