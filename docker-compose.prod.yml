services:
  app:
    image: ghcr.io/${GITHUB_REPOSITORY_OWNER:-YOUR_GITHUB_USERNAME}/chatrelay-app:prod-latest
    container_name: chatrelay-prod
    env_file:
      - .env.production
    environment:
      NODE_ENV: production
      PORT: 8081
      TOOL_SERVICE_URL: http://agent-service:8090
    ports:
      - "8081:8081"
    volumes:
      - ./data:/app/data
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      agent-service:
        condition: service_started
    restart: unless-stopped

  agent-service:
    image: ghcr.io/${GITHUB_REPOSITORY_OWNER:-YOUR_GITHUB_USERNAME}/chatrelay-agent-service:prod-latest
    container_name: chatrelay-agent-prod
    env_file:
      - .env.production
    environment:
      MCP_GATEWAY_URL: ${MCP_GATEWAY_URL:-http://mcp-gateway:8080}
      MCP_TRANSPORT: ${MCP_TRANSPORT:-streamable-http}
    ports:
      - "8090:8090"
    depends_on:
      mcp-gateway:
        condition: service_started
    restart: unless-stopped

  mcp-gateway:
    image: docker/mcp-gateway:latest
    container_name: chatrelay-mcp-prod
    command:
      - --transport=streaming
      - --catalog=/mcp-config/catalog.yaml
      - --servers=fetch,node-code-sandbox
      - --port=8080
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./mcp:/mcp-config:ro
    ports:
      - "8080:8080"
    restart: unless-stopped
