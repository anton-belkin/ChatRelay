option_settings:
  # Instance configuration
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.medium
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role
    EC2KeyName: chatrelay-eb-key
    SecurityGroups: chatrelay-eb-sg

  # Environment properties
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    PORT: 8081
    AGENT_SERVICE_PORT: 8090
    TOOL_BRIDGE_PORT: 8080
    OPENAI_MODEL: gpt-4o
    HISTORY_MAX_MESSAGES: 50
    AGENT_SERVICE_URL: http://localhost:8090
    TOOL_BRIDGE_URL: http://localhost:8080
    LOG_LEVEL: info

  # Container commands
  aws:elasticbeanstalk:container:docker:
    EnableDocker: true

  # Health check configuration
  aws:elasticbeanstalk:application:
    Application Healthcheck URL: HTTP:8081/health

  # Load balancer
  aws:elbv2:listener:default:
    ListenerEnabled: true
    Protocol: HTTP

  # Platform settings
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced

  # CloudWatch monitoring
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7

files:
  "/etc/profile.d/chatrelay.sh":
    mode: "000644"
    owner: root
    group: root
    content: |
      export CHATRELAY_VERSION=1.4.0
